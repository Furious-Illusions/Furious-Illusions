@using System.Data

@{
    ViewBag.Title = "Create";
    Layout = "~/Views/Shared/_Layout.cshtml";

    DataSet ds = Session["xmlDataSet"] as DataSet;

    var i = 1;
    foreach (DataRow dr in ds.Tables[0].Rows)
    { i++; }
}
<b><i>Create a new Song.</i></b>
<form method="post" action="">
    <table>
        <tr>
            <td>ID:</td>
            <td>@{Write(i);}</td>
        </tr>
        <tr>
            <td>Artist:</td>
            <td><input type="text" size="40" name="artist" placeholder="Artist" value=""></td>
        </tr>
        <tr>
            <td>Song title:</td>
            <td><input type="text" size="40" name="title" placeholder="Title of the song" value=""></td>
        </tr>
        <tr>
            <td>Publication year:</td>
            <td><input type="text" size="40" name="publication" placeholder="Publication year" value=""></td>
        </tr>
        <tr>
            <td>Genre:</td>
            <td><input type="text" size="40" name="genre" placeholder="Genre" value=""></td>
        </tr>
        <tr>
            <td>Duration:</td>
            <td><input type="text" size="40" name="duration" placeholder="Duration" value=""></td>
        </tr>
        <tr>
            <td>Youtube Url Link:</td>
            <td><input type="text" size="40" name="link" placeholder="Url link" value=""></td>
        </tr>
        <tr>
            <td><input type="submit" name="" value="Toevoegen"></td>
        </tr>
    </table>
</form>
<br />
<button><a href="Index" style="float:right;">Cancel</a></button>

@{
    if (IsPost)
    { 
        string waarde = Request.Form["inputelement"];
        DataRow dr = ds.Tables[0].NewRow();
        
        string s = Request.Form["link"].ToString();
        string v = s.Replace("watch?v=", "embed/");
        
        dr["id"] = i;
        dr["artist"] = Request.Form["artist"];
        dr["title"] = Request.Form["title"];
        dr["publication"] = Request.Form["publication"];
        dr["genre"] = Request.Form["genre"];
        dr["duration"] = Request.Form["duration"];
        dr["link"] = v + "?autoplay=1";
        
        if (string.IsNullOrWhiteSpace(Request.Form["artist"]) ||
        string.IsNullOrWhiteSpace(Request.Form["title"]) ||
        string.IsNullOrWhiteSpace(Request.Form["publication"]) ||
        string.IsNullOrWhiteSpace(Request.Form["genre"]) ||
        string.IsNullOrWhiteSpace(Request.Form["duration"]) ||
        string.IsNullOrWhiteSpace(Request.Form["link"]))
        {
            Response.Write("<h2 style='color: red;'> Nog niet alle velden zijn ingevuld!<h2>");
        }
        else
        {
            ds.Tables[0].Rows.Add(dr);
            ds.WriteXml(Server.MapPath("../App_Data/playlist.xml"));
            Response.Redirect("Index");
        }
    }
}